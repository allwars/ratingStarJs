<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="loading.css" />
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div class="rating" id="rating">
      <!--<form name="submit-form" id="sheetdb-form">
                 <label class="form-label" for="5"><b>☆</b></label>
        <input
          class="form-label"
          type="radio"
          name="rating"
          required
          value="5"
        />
        <label class="form-label" for="4"><b>☆</b></label>
        <input
          class="form-label"
          type="radio"
          name="rating"
          required
          value="4"
        />
        <label class="form-label" for="3"><b>☆</b></label>
        <input
          class="form-label"
          type="radio"
          name="rating"
          required
          value="3"
        />
        <label class="form-label" for="2"><b>☆</b></label>
        <input
          class="form-label"
          type="radio"
          name="rating"
          required
          value="2"
        />
        <label class="form-label" for="1"><b>☆</b></label>
        <input
          class="form-label"
          type="radio"
          name="rating"
          value="1"
        /> 
        <div style="display: none" id="urlWeb1"></div>
        <div style="display: none" id="date1"></div>
      </form>-->
    </div>
    <script>
      document.body.onload = addElement;

      var ip_addr = window.location.hostname;
      const scriptURL =
        "https://script.google.com/macros/s/AKfycbxj-zGBligkehc9Srm-LcZovBDiUpVZ17LxK8ZMnal5YPewnczKC3ipDVihRPyusDwljg/exec";
      const form = document.forms["submit-form"];
      const congrat = "<p>yeeeepa!!!</p> \n  <h3>¡Gracias por darnos tu opinión!</h3>";

      var destiny = window.location.href;
      //const congrat = "<h3>¡Gracias por darnos tu opinión!</h3>";
      var date = new Date();

      const formatDate = (date) => {
        let formatted_date =
          date.getDate() +
          "-" +
          (date.getMonth() + 1) +
          "-" +
          date.getFullYear() +
          " " +
          date.getHours() +
          ":" +
          date.getMinutes() +
          ":" +
          date.getSeconds();
        return formatted_date;
      };
      const date2 =
        '<input type="text" name="date" value="' + formatDate(date) + '">';
      const urlWeb = '<input type="url" name="url" value="' + destiny + '">';

      ///////////////////fin variables/////////////////////////
      function addElement() {
        const formRating = document.createElement("form");
        formRating.setAttribute("name", "submit-form");
        formRating.setAttribute("id", "sheetdb-form");

        var ratingContent = document.getElementById("rating");
        ratingContent.insertAdjacentElement("afterbegin", formRating);

        for (var z = 1; z < 6; z++) {
          console.log(z);
          const x = document.createElement("label");
          x.setAttribute("for", z);
          x.setAttribute("class", "form-label");
          x.setAttribute("id", "labelform");
          const y = document.createElement("b");
          const contentLabel = document.createTextNode("☆");
          x.appendChild(y);
          y.appendChild(contentLabel);

          const i = document.createElement("input");
          i.setAttribute("type", "radio");
          i.setAttribute("name", "rating");
          i.setAttribute("value", z);
          i.setAttribute("class", "form-label");
          var addressContainer = document.getElementById("sheetdb-form");
          addressContainer.insertAdjacentElement("afterbegin", i);
          addressContainer.insertAdjacentElement("afterbegin", x);
        }
        const arrayA = ["urlWeb1", "date1"];
        const arrayLength = arrayA.length;
        for (var b = 0; b < arrayLength; b++) {
          const a = document.createElement("div");
          a.setAttribute("style", "display: none");
          a.setAttribute("id", arrayA[b]);
          var addressContainer1 = document.getElementById("sheetdb-form");
          addressContainer1.insertAdjacentElement("beforeend", a);
        }

        const loader = document.createElement("div");
        loader.setAttribute("class", "loader");
        loader.setAttribute("id", "loaderId");
        loader.setAttribute("style", "display: none;");
        var loaderContainer = document.getElementById("rating");
        loaderContainer.insertAdjacentElement("afterbegin", loader);
        for (var j = 0; j < 3; j++) {
          const loaderBall = document.createElement("span");
          loaderBall.setAttribute("class", "loader__element");
          var balls = document.getElementById("loaderId");
          balls.insertAdjacentElement("afterbegin", loaderBall);
        }

        var loaderId = document.getElementById("loaderId");
        if (document.querySelector('input[name="rating"]')) {
          document.querySelectorAll('input[name="rating"]').forEach((elem) => {
            elem.addEventListener("change", (e) => {
              document.getElementById("date1").innerHTML = date2;
              document.getElementById("urlWeb1").innerHTML = urlWeb;
              addressContainer.style.display = "none";
              loaderId.style.display = "flex";

              const i = document.createElement("input");

              console.log("work it");

              e.preventDefault();
              fetch(scriptURL, {
                method: "POST",
                body: new FormData(form),
              })
                .then((response) => console.log("Success!", response))
                .catch((error) => console.error("Error!", error.message))
                .then((html) => {
                  document.getElementById("rating").innerHTML = congrat;
                });
            });
          });
        }
      }
    </script>
  </body>
</html>
